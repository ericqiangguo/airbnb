<!DOCTYPE html>
<html>
  <head>
    <title>Add a Room</title>
    <meta name="viewport" content="initial-scale=1.0" />
    <meta charset="utf-8" />
    <style>
      /* Always set the map height explicitly to define the size of the div
       * element that contains the map. */
      #map {
        height: 40%;
        margin-top:-15.5px;
      }
      /* Optional: Makes the sample page fill the window. */
      html,
      body {
        height: 100%;
        margin: 0;
        padding: 0;
      }
      /*set the background*/
      .bg {
            background: url('./img/addroom_img.jpg');
            background-repeat: no-repeat;
            background-position: center;
            background-size: cover; 
            /* vertical-align: middle; */
            /* background-clip:border-box; */
            height:auto;
            line-height: auto;
            background-color:transparent;

      }
      .inner{
        height:100%;
        background: rgba(138, 134, 134, 0.575);
      }

      .title{
        padding:100px;
        margin-top:-30px;
      }
      .center{text-align:center}
      .textBg{
        background:rgb(209, 206, 206);
        height:100%;
        width:40%;
        /* text-align: center; */
        margin-left: 30%;
        margin-right:20%;
        margin-top:-5%;
        margin-bottom:100px;
        font-size:100%;
        color:rgb(17, 17, 17);
        border-radius:25px;
        padding:0.5cm;
      }
      /*set the nav bar*/
      .tag{
        width: auto;
        height: 180%;
        /* object-fit:cover; */

      } 
      
   
  
  
     

/* unpoad picture*/
.file-box {
    position: relative;
    display: inline-block;
    margin-top:0;
    width:100%;
}
.file-box img {
    width: 100%;
    height: 150%;
    border-radius: 5%;
    position: middle;
    /* display: inline-block; */
    /* border: none; */
}
.file-box .txt,.file-box .file {
    width: 70px;
    height: 36px;
    position: absolute;
    top: -20px;
    left: 100px;
    text-align: center;
}

.comments {
	width: 100%; /*自动适应父布局宽度*/
	overflow: auto;
	word-break: break-all;
}

.marginCreat{
  margin-top:5%;
}




    </style>
    <!-- <link href="css/bootstrap.min.css" rel="stylesheet" /> -->
    <link href="css/style.css" rel="stylesheet" />
    <link rel="stylesheet" href="https://cdn.staticfile.org/twitter-bootstrap/3.3.7/css/bootstrap.min.css">
	  <script src="https://cdn.staticfile.org/jquery/2.1.1/jquery.min.js"></script>
   	<script src="https://cdn.staticfile.org/twitter-bootstrap/3.3.7/js/bootstrap.min.js"></script>
  </head>



  <body>
      <nav class="navbar navbar-default navbar-fixed-top" role="navigation"> 
          <div class="container-fluid"> 
            <div class="navbar-header">
              <div class="navbar-brand">
                <img  src="/img/logo.png" class="tag" alt="" >
              </div>    
            </div> 
            <div id="navbar" class="collapse navbar-collapse">
              <ul class="nav navbar-nav">
                <li><a href="/homepage.html">Home</a></li>
                <li><a href="/index.html">Sign In</a></li>
                <li><a href="/signup.html">Sign Up</a></li>
                <li class="active"><a href="/">Add Room</a></li>
                <li><a href="">About</a></li>
                </ul> 
            </div> 
        </nav>


    <div id="map"></div>
    <div class="bg">
      <div class="inner">

        <div class="container-fluid center">
          <div class="title">
            <div class="row">
              <div class="col-md-12">
                <h3>
                  Add a room
                </h3>
              </div>
            </div>
          </div>

          <div class="row">
            <div class="col-md-12">
              <div class="textBg">
                <form role="form" id="add-form" method="post">
                  <div class="form-group">
                    <label for="name">
                      House name
                    </label>
                    <div align="center">
                      <input type="text" class="form-control" id="name" name="name" />
                      <span id = "reminder_housename"></span>
                    </div>
                  </div>
                  <div class="form-group">
                    <label for="street">
                      Street
                    </label>
                    <div align="center">
                      <input
                        type="text"
                        class="form-control"
                        id="street"
                        name="street"
                      />
                      <span id = "reminder_street"></span>
                    </div>
                  </div>
                  <div class="form-group" align="center">
                    <label for="City">
                      City
                    </label>
                    <input type="text" class="form-control" id="city" name="city" />
                    <span id = "reminder_city"></span>
                    <span id="checktext2" class="warning"></span>
                  </div>
                  <div class="form-group">
                    <label for="provinces">
                      Province
                    </label>
                    <div align="center">
                    <input
                      type="text"
                      class="form-control"
                      id="Provinces"
                      name="Provinces"
                      list="Provinces_list"
                      onchange="remap()"
                    />
                    <span id = "reminder_province"></span>
                    </div>
                    <datalist id="Provinces_list">
                      <option>NL</option>
                      <option>PE</option>
                      <option>NS</option>
                      <option>NB</option>
                      <option>QC</option>
                      <option>ON</option>
                      <option>MB</option>
                      <option>SK</option>
                      <option>AB</option>
                      <option>BC</option>
                      <option>YT</option>
                      <option>NT</option>
                      <option>NU</option>
                    </datalist>
                   </div>
                  <div class="form-group">
                    <label for="code">
                      Postal code
                    </label>
                    <div align="center">
                    <input type="text" class="form-control" id="code" name="code" />
                    <span id = "reminder_code"></span>
                    </div>
                  </div>
                  <div class="form-group" align="center">
                    <label for="exampleInputPassword1">
                      Number of bed
                    </label>
                    <input
                      type="number"
                      class="form-control"
                      id="beds"
                      name= "beds"
                      placeholder="1"
                    />
                    <span id = "reminder_beds"></span>
                    <span id = "reminder_beds_num"></span>
                  </div>
                  <div class="form-group" align="center">
                      <label for="exampleInputPassword1">
                        Price
                      </label>
                      <input
                        type="number"
                        class="form-control"
                        id="price"
                        name = "price"
                        placeholder="100"
                      />
                      <span id = "reminder_price"></span>
                      <span id = "reminder_price_value"></span>
                    </div>
                  <div class="form-group" align="center">
                    <label for="exampleInputPassword1">
                      Check in
                    </label>
                    <input type="date" class="form-control" id="date_start" name = "date_start" />
                    <span id = "reminder_checkin"></span>
                  </div>
                  <div class="form-group" align="center">
                    <label for="exampleInputPassword1">
                      Check out
                    </label>
                    <input type="date" class="form-control" id="date_end" name = "date_end" />
                    <span id = "reminder_checkout"></span>
                  </div>
                  <div class="form-group" align="center"> 
                    <label for="exampleInputEmail1">
                      Description
                    </label>
                    <textarea 
                      rows="5" 
                      cols="50" 
                      placeholder="Add some details about the room for your guest." 
                      class="comments"
                      id = "des"
                      name = "des"
                      autofocus>
                    </textarea>
                  </div>
                  <div class="file-box">
                      <img id="preview" />
                      <!-- <input type="text" id="imgfield" class="txt" placeholder="预览"> -->
                      <input type="file" name="file" id = "input_file" accept="image/gif,image/jpeg,image/jpg,image/png,image/svg" onchange="imgPreview(this)" >  
                  </div>
                 
                  
             
                  <div class="form-group marginCreat" align="center" > 
                    <button type="submit" class="btn btn-primary" id = "create" value="create">
                      Create your room
                    </button>
                  </div>
                </form>
            </div>
          </div>
        </div>
      </div>
    </div>
    </div>
      <script>
      var map;
      var lat;
      var lng;
      var placeid;
      var now = new Date();
      var day = ("0" + now.getDate()).slice(-2);
      var month = ("0" + (now.getMonth() + 1)).slice(-2);
      var today = now.getFullYear()+"-"+(month)+"-"+(day) ;
      $('#date_start').val(today);
      var next_month = ("0" + (now.getMonth() + 2)).slice(-2);
      var end_date = now.getFullYear()+"-"+(next_month)+"-"+(day);
      $('#date_end').val(end_date);
      function initMap() {
        map = new google.maps.Map(document.getElementById("map"), {
          center: { lat: -34.397, lng: 150.644 },
          zoom: 15
        });
      }
      function remap() {
        var geocoder = new google.maps.Geocoder();
        geocodeAddress(geocoder, map);
        function geocodeAddress(geocoder, resultsMap) {
          var street = document.getElementById("street").value;
          var city = document.getElementById("city").value;
          var provinces = document.getElementById("Provinces").value;
          var address = street + ", " + city + ", " + provinces;
          geocoder.geocode({ address: address }, function(results, status) {
            if (status === "OK") {
              resultsMap.setCenter(results[0].geometry.location);
              map.setZoom(15);
              var marker = new google.maps.Marker({
                map: resultsMap,
                position: results[0].geometry.location
              });
              lat = results[0].geometry.location.lat();
              lng = results[0].geometry.location.lng();
              placeid = results[0].place_id;
            } else {
              alert(
                "Geocode was not successful for the following reason: " + status
              );
            }
          });
        }
      }


      var flag = 0;
      var form_login = document.getElementById("add-form");
      form_login.onsubmit = function(e) {
        e.preventDefault();
        var housename = document.getElementById("name").value;
        if (housename == "") {
      document.getElementById("reminder_housename").innerHTML =
        "please enter your house name";
        flag = 1;
    }
        var streetname = document.getElementById("street").value;
        if (streetname == "") {
      document.getElementById("reminder_street").innerHTML =
        "please enter your street";
        flag = 1;
    }
        var cityname = document.getElementById("city").value;
        if (cityname == "") {
      document.getElementById("reminder_city").innerHTML =
        "please enter your city";
        flag = 1;
    }
        var provincename = document.getElementById("Provinces").value;
        if (provincename == "") {
      document.getElementById("reminder_province").innerHTML =
        "please enter your province";
        flag = 1;
    }
        var postalcode = document.getElementById("code").value;
        if (postalcode == "") {
      document.getElementById("reminder_code").innerHTML =
        "please enter your postal code";
         flag = 1;
    }
        var bed_num = document.getElementById("beds").value;
        if (bed_num == "") {
      document.getElementById("reminder_beds").innerHTML =
        "please enter your beds";
        flag = 1;
    }
    if (bed_num < 0)
    {
      document.getElementById("reminder_beds_num").innerHTML = 
        "please enter your correct number";
    }
        var price = document.getElementById("price").value;
        if (price == "") {
      document.getElementById("reminder_price").innerHTML =
        "please enter your price";
        flag = 1;
    }
        if (price < 0) {
      document.getElementById("reminder_price_value").innerHTML =
        "please enter your correct price";
        flag = 1;
    }
        var startdate = document.getElementById("date_start").value;
        if (startdate == "") {
      document.getElementById("reminder_checkin").innerHTML =
        "please enter your check-in date";
        flag = 1;
    }
        var enddate = document.getElementById("date_end").value;
        if (enddate == "") {
      document.getElementById("reminder_checkout").innerHTML =
        "please enter your check-out date";
        flag = 1;
    }
        var description = document.getElementById("des").value;
        if(flag == 0)
        {

        $.ajax({
          type: "POST",
          url: "/api/house/create",
          xhrFields: {
            withCredentials: true
          },
          crossDomain: true,
          data: {
            house_name: housename,
            place_id: placeid,
            house_address: streetname,
            house_city: cityname,
            house_province: provincename,
            house_postcode: postalcode,
            longitude: lng,
            latitude: lat,
            number_of_beds: bed_num,
            price: price,
            date_begin: startdate,
            date_end: enddate,
            description: description 
          },
          success: function(msg) {
            console.log(msg);
            window.location.href = "/homepage.html";
          },
          fail: function() {
            console.log("add failed");
            alert("add failed, see dev tool");
          }
        });
      }
      flag = 0;
      };



/* js of upload img*/  
      function imgPreview(fileDom) {
    
         if(window.FileReader) {
           var reader = new FileReader();
         } 
         else {
           alert("您的设备不支持图片预览功能，如需该功能请升级您的设备！");
         }
    
         var file = fileDom.files[0];
         var imageType = /^image\//;
    
         if(!imageType.test(file.type)) {
           alert("请选择图片！");
        return;
         }
    
    reader.onload = function(e) {
        
        var img = document.getElementById("preview");
    
        img.src = e.target.result;
    };
    reader.readAsDataURL(file);
}









    </script>
    <script
      src="https://maps.googleapis.com/maps/api/js?key=AIzaSyDEr7VaXJrWbi79GbHar7CPAS1LyYDAyew&callback=initMap"
      async
      defer
    ></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/popper.js/1.11.0/umd/popper.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/4.2.1/js/bootstrap.min.js"></script>
  </body>
</html>
